<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Blockly Demo: Resizable Blockly (Part 2)</title>
        <script src="blockly/blockly_compressed.js"></script>
        <script src="blockly/javascript_compressed.js"></script>
        <script src="blockly/blocks_compressed.js"></script>
        <script src="blockly/blocks/robot.js"></script>
        <script src="blockly/generators/javascript/robot.js"></script>
        <script src="blockly/msg/js/en.js"></script>
        <style>
            html, body {
                height: 100%;
                margin: 0;
            }
            body {
                background-color: #fff;
                font-family: sans-serif;
                overflow: scroll;
            }
            .row {
                display: flex;
            }

            .column {
                flex: 50%;
            }
            #blocklyArea {
                height: 512px;
            }
        </style>
    </head>
    <body>

        <button onclick=execute()>Run</button>
        <div class="row">
            <div class="column">
                <div id="blocklyArea">
                    <div id="blocklyDiv"></div>
                </div>
            </div>
            <div class="column">
                <canvas id="myCanvas" width="500" height="500" style="border:1px solid #000000;">
                </canvas>
            </div>
        </div>


        <script>
            function execute(){
                Blockly.JavaScript.addReservedWords('code');
                var code = Blockly.JavaScript.workspaceToCode(workspace);
                try {
                    eval(code);
                } catch (e) {
                    alert(e);
                }
            }
        </script>

        <script> //load toolbox
            var Connect = new XMLHttpRequest();
            // Define which file to open and
            // send the request.
            Connect.open("GET", "toolbox.xml", false);
            Connect.setRequestHeader("Content-Type", "text/xml");
            Connect.send(null);
            // Place the response in an XML document.
            var toolbox = Connect.responseXML.childNodes[0];
        </script>

        <script> //blockly workspace
            var blocklyArea = document.getElementById('blocklyArea');
            var blocklyDiv = document.getElementById('blocklyDiv');
            var workspace = Blockly.inject(blocklyDiv,
                                           {media: 'https://blockly-demo.appspot.com/static/media/',
                                            toolbox: toolbox});
            var onresize = function(e) {
                // Compute the absolute coordinates and dimensions of blocklyArea.
                var element = blocklyArea;
                var x = 0;
                var y = 0;
                do {
                    x += element.offsetLeft;
                    y += element.offsetTop; 
                    element = element.offsetParent;
                } while (element);
                // Position blocklyDiv over blocklyArea.
                blocklyDiv.style.left = x + 'px';
                blocklyDiv.style.top = y + 'px';
                blocklyDiv.style.width = blocklyArea.offsetWidth + 'px';
                blocklyDiv.style.height = blocklyArea.offsetHeight + 'px';
                Blockly.svgResize(workspace);
            };
            window.addEventListener('resize', onresize, false);
            onresize();
            Blockly.svgResize(workspace);
        </script>
    </body>
</html>
